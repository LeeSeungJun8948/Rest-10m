<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.rest.app.fac.service.impl.FacilitiesMapper">
	<select id="getFac"
		resultType="com.rest.app.fac.vo.FacilitiesVO">
		select f.FAC_CODE,
		f.FACILITIES_NAME,
		f.MODEL,
		f.FAC_SIZE,
		f.PRODUCTION_COMPANY,
		f.PURPOSE,
		f.VOLUME,
		f.PRODUCTION_DATE,
		f.EMP_NO,
		f.PRICE,
		f.FAC_INSPECTION,
		f.PURCHASE_DATE,
		f.IMG,
   		p.process_name
		from facilities f, process p
  		<where>
  		f.process_code=p.process_code
  		<if test="searchCondition == 'facilitiesName'">and
  			f.facilities_name LIKE '%' || #{searchKeyword} || '%'
  		</if>
  		<if test="searchCondition == 'processName'">and
  			p.process_name LIKE '%' || #{searchKeyword} || '%'
  		</if>
  		</where>
   		order by fac_code
	</select>
	<insert id="insertFac"
		parameterType="com.rest.app.fac.vo.FacilitiesVO">
		insert into FACILITIES
		values(fac_seq.nextval, #{facilitiesName}, #{model}, #{facSize}, #{productionCompany},
		#{purpose}, #{volume}, #{productionDate}, #{empNo}, #{price},
		#{facInspection}, #{purchaseDate}, #{img}, #{processCode})
	</insert>
	<delete id="deleteFac"
		parameterType="com.rest.app.fac.vo.FacilitiesVO">
		delete from facilities where fac_code=#{facCode}
	</delete>
	<select id="getFacProcess" resultType="com.rest.app.fac.vo.FacilitiesVO">
		select f.fac_code, f.facilities_name, f.process_code, p.process_name
		from facilities f, process p
		where f.process_code=p.process_code
		order by fac_code
	</select>
	<select id="getFacInfo" resultType="com.rest.app.fac.vo.FacilitiesVO" parameterType="com.rest.app.fac.vo.FacilitiesVO">
		select 
			fac_code,
			FACILITIES_NAME,
			MODEL,
			FAC_SIZE,
			PRODUCTION_COMPANY,
			PURPOSE,
			VOLUME,
			PRODUCTION_DATE,
			EMP_NO,
			PRICE,
			FAC_INSPECTION,
			PURCHASE_DATE,
			IMG,
			PROCESS_CODE
		from facilities
		where fac_code = #{facCode}
	</select>
	<update id="updateFac" parameterType="com.rest.app.fac.vo.FacilitiesVO">
		update 
			facilities
		set 
			FACILITIES_NAME=#{facilitiesName}, MODEL=#{model}, FAC_SIZE=#{facSize},
			PRODUCTION_COMPANY=#{productionCompany}, PURPOSE=#{purpose},
			VOLUME=#{volume}, PRODUCTION_DATE=#{productionDate}, EMP_NO=#{empNo},
			PRICE=#{price}, FAC_INSPECTION=#{facInspection}, PURCHASE_DATE=#{purchaseDate},
			PROCESS_CODE=#{processCode}
			
			<if test="img!=null and img!=''">
				,IMG=#{img}
			</if> 
		where
			fac_code=#{facCode}
	</update>
	<select id="getFacCode" resultType="int">
    	select max(fac_code) + 1 as fac_code from facilities
    </select>
</mapper>